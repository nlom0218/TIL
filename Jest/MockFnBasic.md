# ëª¨ì˜ í•¨ìˆ˜(Mock Functions) ì‚¬ìš©í•˜ê¸°

## 1. ê°œìš”

Jestì˜ `Mock Functions`ì— ëŒ€í•´ ì •ë¦¬í•œë‹¤.

---

## 2. Mock Functions(mockFn)ì´ë€?

Mockì€ `ê±°ì§“ëœ`, `ê°€ì§œì˜`ì˜ ëœ»ì„ ê°€ì§„ë‹¤. ì¦‰, `mockFn`ì„ ì§ì—­í•˜ìë©´ `ê°€ì§œì˜ í•¨ìˆ˜ë“¤`ì´ ëœë‹¤. ê·¸ë¦¬ê³  `Mocking`ì´ë¼ëŠ” ê²ƒì€ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ë•Œ, í•´ë‹¹ ì½”ë“œê°€ ì˜ì¡´í•˜ëŠ” ë¶€ë¶„ì„ ê°€ì§œ(mock)ë¡œ ëŒ€ì²´í•˜ëŠ” ê¸°ë²•ì´ë‹¤.

ì—¬ê¸°ì„œ ì˜ë¬¸ì´ ë“ ë‹¤. ì™œ `ê°€ì§œì˜ í•¨ìˆ˜ë“¤`ì„ ë§Œë“¤ì–´ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ëŠ” ê²ƒì¼ê¹Œ?

ê·¸ ì´ìœ ëŠ”, í…ŒìŠ¤íŠ¸ í•˜ê³  ì‹¶ì€ ê¸°ëŠ¥ì´ ë‹¤ë¥¸ ê¸°ëŠ¥ë“¤ê³¼ ì—®ì—¬ìˆì„ ê²½ìš°(ì˜ì¡´) ì •í™•í•œ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê¸° í˜ë“¤ê¸° ë•Œë¬¸ì´ë‹¤. ì—¬ê¸°ì„œ `mockFn`ê³¼ `Mocking`ì˜ íŠ¹ì§•ê³¼ ì¥ì ì„ ì•Œ ìˆ˜ ìˆë‹¤.

1. ì‹¤ì œ ê°ì²´ì¸ ì²™í•˜ëŠ” ê°€ì§œ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
2. í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ ê°€ì§œ ê°ì²´ì— ì–´ë–¤ ì¼ë“¤ì´ ë°œìƒí–ˆëŠ”ì§€ ê¸°ì–µí•˜ê¸° ë•Œë¬¸ì— ê°€ì§œ ê°ì²´ê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì–´ë–»ê²Œ ì‚¬ìš©ë˜ëŠ”ì§€ ê²€ì¦í•  ìˆ˜ ìˆë‹¤.
3. ì‹¤ì œ ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ í›¨ì”¬ ê°€ë³ê³  ë¹ ë¥´ê²Œ ì‹¤í–‰ëœë‹¤.
4. í•­ìƒ ë™ì¼í•œ ê²°ê³¼ë¥¼ ë‚´ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

---

## 3. jest.fn()

`mockFn`ë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê¸° ìœ„í•´ì„  ë¨¼ì € ê°€ì§œ í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ëŠ” ê³¼ì •ì„ ê±°ì³ì•¼ í•œë‹¤. ì´ë¥¼ ë„ì™€ì£¼ëŠ” ê²ƒì¸ `jest.fn()` í•¨ìˆ˜ì´ë‹¤.

`jest.fn()` í•¨ìˆ˜ì˜ ì‚¬ìš© ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ë‹¤.

```javascript
const mockFn = jest.fn();
```

ìƒì„±ëœ ê°€ì§œ í•¨ìˆ˜ëŠ” ì¼ë°˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ í•¨ìˆ˜ì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì¸ìë¥¼ ë„˜ê²¨ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.

```javascript
mockFn();
mockFn(1);
mockFn('nlom0218');
```

ì•„ì§ ì•„ë¬´ëŸ° ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ìœ„ì˜ ê²°ê³¼ëŠ” ëª¨ë‘ `undefined`ì´ë‹¤.

ì§€ê¸ˆê¹Œì§€ `mockFn`ì„ ìƒì„±í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì•˜ë‹¤. ë§¤ìš° ê°„ë‹¨í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤. ì´ì œ ìƒì„±ëœ `mockFn`ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ë©”ì„œë“œë¥¼ ì•Œì•„ë³´ì.

---

### 3-1. mockFn.mockReturnValue(value)

`mockFn`ê°€ ë¦¬í„´í•˜ëŠ” ê°’ì„ ì§€ì •í•˜ëŠ” ë©”ì„œë“œì´ë‹¤.

```javascript
const mock = jest.fn();

mock.mockReturnValue('1');
mock(); // 1

mock.mockReturnValue('Hello');
mock(); // 'Hello'

mock.mockReturnValue(true);
mock(); // true
```

---

### 3-2. mockFn.mockReturnValueOnce(value)

ë‹¨ í•œë²ˆë§Œ íŠ¹ì • ê°’ì„ ë¦¬í„´í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ë©”ì„œë“œì´ë©° `ë©”ì„œë“œ ì²´ì´ë‹`ìœ¼ë¡œ ì—°ê²°ë  ìˆ˜ ìˆë‹¤. ë” ì´ìƒì˜ `mockReturnValueOnce(value)` ë©”ì„œë“œê°€ ì‚¬ìš©ë˜ì§€ ì•Šìœ¼ë©´ `mockReturnValue(value)` ë©”ì„œë“œë¡œ ì§€ì •ëœ ê°’ì´ ë¦¬í„´ëœë‹¤.

```javascript
const mockFn = jest
  .fn()
  .mockReturnValueOnce(1)
  .mockReturnValueOnce(2)
  .mockReturnValueOnce(3)
  .mockReturnValue(0);

mockFn(); // 1
mockFn(); // 2
mockFn(); // 3
mockFn(); // 0
mockFn(); // 0
```

---

### 3-3. mockFn.mockImplementation(fn)

`mockFn`ê°€ ì–´ë–¤ ë™ì‘ì„ í•˜ëŠ”ì§€ ì •í•´ì£¼ëŠ” ë©”ì„œë“œì´ë‹¤. ë™ì‘í•˜ëŠ” `mockFn`ë¥¼ ë§Œë“œëŠ” ê²ƒì´ë¼ê³  ë³´ë©´ ëœë‹¤.

```javascript
const mockFn = jest.fn((a, b) => a + b);

mockFn(1, 2); // 3

mockFn(10, 12); // 4
```

---

### 3-4. mockFn.mockImplementationOnce(fn)

`mockFn`ì˜ ë™ì‘ì„ í•œ ë²ˆë§Œ ì œí•œì„ ë‘˜ ë•Œ ì‚¬ìš©ë˜ëŠ” ë©”ì„œë“œì´ë‹¤. ë‹¨ í•œ ë²ˆë§Œ ì‚¬ìš©ë˜ë©° ì´í›„ì—” `mockImplementation(fn)` ë©”ì„œë“œë¥¼ í†µí•´ ì •í•œ ë™ì‘ì´ ì‹¤í–‰ëœë‹¤.

```javascript
const mockFn = jest.fn();

mockFn
  .mockImplementation((a, b) => a + b)
  .mockImplementationOnce((a, b) => a * b)
  .mockImplementationOnce((a, b) => a / b);

mockFn(3, 4); // 12 (3 * 4)
mockFn(18, 6); // 3 (18 / 6)
mockFn(2, 6); // 8 (2 + 6)
```

ê¸°ë³¸ ë™ì‘ì€ `ë”í•˜ê¸°`ì´ì§€ë§Œ, `ê³±í•˜ê¸°`ì™€ `ë‚˜ëˆ—ì…ˆ`ì´ ìˆœì„œëŒ€ë¡œ í•œ ë²ˆì”© ì‚¬ìš©ë˜ëŠ” ì½”ë“œì´ë‹¤.

---

### 3-5. mockFn.mockResolvedValue(value)

ë¹„ë™ê¸° í•¨ìˆ˜ì—ì„œ `resolve` ê°’ì„ ë°›ì„ ë•Œ ì‚¬ìš©ëœë‹¤. ì¶”ê°€ì ìœ¼ë¡œ `mockFn.mockResolvedValueOnce(value)` ë©”ì„œë“œëŠ” í•œ ë²ˆ ë§Œ `resolve` ê°’ì„ ë°›ì„ ë•Œ ì‚¬ìš©ëœë‹¤.

```javascript
test('async test', async () => {
  const asyncMock = jest.fn().mockResolvedValue(43);

  await asyncMock(); // 43
});
```

`mockResolvedValue(value)` ë©”ì„œë“œëŠ” `mockImplementation(fn)` ë©”ì„œë“œë¡œ í‘œí˜„ì´ ê°€ëŠ¥í•˜ë‹¤. ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ `mockFn`ë¡œ ë§Œë“¤ ë•, `mockResolvedValue(value)` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë”ìš± ê°„ê²°í•˜ê³  ê°€ë…ì„±ì´ ë†’ë‹¤. ì•„ë˜ì˜ ë‘ í•¨ìˆ˜ëŠ” ê°™ì€ ì—­í• ì„ í•œë‹¤.

```javascript
jest.fn().mockImplementation(() => Promise.resolve(value));

jest.fn().mockResolvedValue(value);
```

---

### 3-6. mockFn.mockRejectedValue(value)

ë¹„ë™ê¸° í•¨ìˆ˜ì—ì„œ `reject` ê°’ì„ ë°›ì„ ë•Œ ì‚¬ìš©ëœë‹¤. í•œ ë²ˆì˜ `reject` ê°’ì„ ë°›ê¸° ìœ„í•´ì„  `mockFn.mockRejectedValueOnce(value)` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```javascript
test('async test', async () => {
  const asyncMock = jest
    .fn()
    .mockRejectedValue(new Error('Async error message'));

  await asyncMock(); // throws 'Async error message'
});
```

`mockRejectedValue(value)` ë©”ì„œë“œë¥¼ `mockResolvedValue(value)`ë¡œ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆë‹¤. ì•„ë˜ì˜ ì½”ë“œë¥¼ ì°¸ê³ 

```javascript
jest.fn().mockImplementation(() => Promise.reject(value));
```

---

## 4. Conclusion

> ì‹¤ì œ í•¨ìˆ˜ê°€ ì•„ë‹ˆë¼ ê°€ì§œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ëŠ” ê³¼ì •ì„ ì •ë¦¬í•´ë³´ì•˜ë‹¤. ê³¼ì—° ì´ ê°€ì§œ í•¨ìˆ˜ê°€ ì–¼ë§ˆë‚˜ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ì´ ë˜ëŠ”ì§€ ì§ì ‘ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ë´ì•¼ ì•Œê² ì§€ë§Œ, ì¼ë‹¨ì€..! ìœ ìš©í•œ ê¸°ëŠ¥ì´ë¼ëŠ” ê²ƒì€ ì–¼ì¶” ì§ì‘ì´ ëœë‹¤.  
> ê·¸ë ‡ë‹¤ë©´ ì–¸ì œ ê°€ì§œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•˜ëŠ” ê²ƒì¸ê°€? ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë‹¤ë£° ë•Œì™€ apië¥¼ ë‹¤ë£° ë•Œê°€ ëŒ€í‘œì ì´ë¼ê³  ìƒê°í•œë‹¤. ì‹¤ì œë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë‹¤ë£¨ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê°€ì§œë¡œ ë°ì´í„°ë¥¼ ë„£ê³  ê°€ì§œë¡œ ê²°ê³¼ë¥¼ ë°›ì•„ì˜¤ëŠ” ê²ƒì´ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤. apiì˜ ê²°ê³¼ë„ ë§ˆì°¬ê°€ì§€ì´ë‹¤.  
> ë¬´ì‘ì • ëª¨ë“  í•¨ìˆ˜ë¥¼ ê°€ì§œ í•¨ìˆ˜ë¡œ ë§Œë“œëŠ” ê²ƒì€ ì¢‹ì€ ë°©ë²•ì´ ì•„ë‹ ê²ƒ ì´ë‹¤. ë§ì€ í…ŒìŠ¤íŠ¸ë¥¼ ì ‘í•´ë³´ë©´ì„œ ê°€ì§œ í•¨ìˆ˜ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì‚¬ìš©í•˜ëŠ” ë¶„ë³„ë ¥ì„ ê¸°ë¥´ë„ë¡ í•˜ì.

---

## ì°¸ê³ 

[[JEST] ğŸ“š ëª¨í‚¹ Mocking ì •ë¦¬ - jest.fn / jest.mock /jest.spyOn](https://inpa.tistory.com/entry/JEST-%F0%9F%93%9A-%EB%AA%A8%ED%82%B9-mocking-jestfn-jestspyOn)  
[[Jest] jest.fn(), jest.spyOn() í•¨ìˆ˜ ëª¨í‚¹](https://www.daleseo.com/jest-fn-spy-on/)

---

ğŸ“… 2022-11-18
